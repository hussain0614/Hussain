# python libraries
import os
import time
import datetime
import pipes
import email
# Database Details
DB_Host = 'localhost'
DB_User = 'root'
DB_Password = ''
DB_Name = ''
Backup_Path = '/backup/dbbackup'
# Get current date and time
DATETIME = time.strftime('%Y%m%d-%H%M%S')
TODAYBACKUPPATH = Backup_Path + '/' + DATETIME
# Check if backup folder exists
try:
    os.stat(TODAYBACKUPPATH)
except:
    os.mkdir(TODAYBACKUPPATH)
os.path.exists(DB_Name)
print ("Starting backup of database" + DB_Name)
multi = 0
email_message = "Backup Information:\n\n"
email_attach = []
# Database backup process
if multi:
    in_file = open(DB_Name, "r")
    flength = len(in_file.readlines())
    in_file.close()
    p=1
    dbfile = open(DB_Name,"r")
    while p <= flength:
        dumpcmd = "mysqldump -h " + DB_Host + " -u " + DB_User + " -p " + DB_Password + "" + db + " > " + pipes.quote(TODAYBACKUPPATH) + "/" + db + ".sql"
        os.system(dumpcmd)
        gzipcmd = "gzip" + pipes.quote(TODAYBACKUPPATH) + "/" + db + ".sql"
        os.system(gzipcmd)
        p = p+1
        dbfile.close()
    else:
        db = DB_Name
        dumpcmd = "mysql -h" + DB_Host + " -u " + DB_User + " -p " + DB_Password + "" + db + " > " + pipes.quote(TODAYBACKUPPATH) + "/" + db + ".sql"
        os.system(dumpcmd)
        gzipcmd = "gzip" + pipes.quote(TODAYBACKUPPATH) + "/" + db + ".sql"
        os.system(gzipcmd)
        print ("")
        print ("Backup script completed")
        print("Backups have been created and stored in '" + TODAYBACKUPPATH + "' directory")
        # Send email with information
        if config.use_mail:
            mail.send(email_message,email_attach)
